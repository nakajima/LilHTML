//
//  ParserTests.swift
//
//
//  Created by Pat Nakajima on 5/2/24.
//

import Foundation
import LilHTML
import XCTest

class ParserTests: XCTestCase {
	func html(_ name: String) -> String {
		return try! String(contentsOf: Bundle.module.url(forResource: name, withExtension: "html")!)
	}

	func testBasicUsage() throws {
		let parser = HTML(html: """
		<div>
			<div class="container">
				<h1>Hi it's & lil tidy</h1>
				<article>
					<p class="one two">hello</p>
					<p>world</p>
				</article>
				<footer>
					<p>it's the footer</p>
				</footer>
			</div>
		</div>
		""")

		// Get an ElementNode
		let parsed = try parser.parse().get()

		// Search for tags
		let paragraphs = parsed.find(.p)
		XCTAssertEqual(3, paragraphs.count) // Passes!

		// Search for tags inside tags
		let footerParagraphs = parsed.find(.p, in: [.footer])
		XCTAssertEqual(1, footerParagraphs.count)

		// Search by attribute
		let firstParagraph = parsed.find(attributes: ["class": .contains("one")])
		XCTAssertEqual(1, firstParagraph.count)
	}

	func testCodable() throws {
		let parsed = try HTML(html: """
		<div>
			<div class="container">
				<h1>Hi it's lil tidy</h1>
				<article>
					<p class="one two">hello</p>
					<p>world</p>
				</article>
				<footer>
					<p>it's the footer</p>
				</footer>
			</div>
		</div>
		""").parse().get()

		let dumped = try JSONEncoder().encode(parsed)
		let loaded = try JSONDecoder().decode(MutableElementNode.self, from: dumped)

		XCTAssertEqual(parsed.toHTML(), loaded.toHTML())
	}

	func testImmutable() throws {
		let parsed = try HTML(html: """
		<div>
			<div class="container">
				<h1>Hi it's lil tidy</h1>
				<article>
					<p class="one two">hello</p>
					<p>world</p>
				</article>
				<footer>
					<p>it's the footer</p>
				</footer>
			</div>
		</div>
		""").parse().get()

		let immutable = parsed.immutableCopy()

		XCTAssertEqual(parsed.toHTML(), immutable.toHTML())

		let immutableDump = try JSONEncoder().encode(immutable)
		let mutable = try JSONDecoder().decode(MutableElementNode.self, from: immutableDump)

		// Make sure we can round trip to immutable then back
		XCTAssertEqual(mutable.toHTML(), parsed.toHTML())
	}

	func testImmutableToMutable() throws {
		let parsed = try HTML(html: """
		<div>
			<div class="container">
				<h1>Hi it's lil tidy</h1>
				<article>
					<p class="one two">hello</p>
					<p>world</p>
				</article>
				<footer>
					<p>it's the footer</p>
				</footer>
			</div>
		</div>
		""").parse().get()

		let immutable = parsed.immutableCopy()
		let mutable = immutable.mutableCopy()
		XCTAssert(mutable.same(as: parsed))
	}

	func testImmutableMusicRadar() throws {
		let text = html("musicradar")
		let html = try HTML(html: text).parse().get().immutableCopy()

		let links = html.search(.a[class: "article-link"])
		XCTAssertEqual(33, links.count)
	}

	func testParsePerformance() {
		let html = html("basic")

		measure {
			for _ in 0 ..< 1000 {
				_ = try! HTML(html: html).parse().get()
			}
		}
	}

	func testBasic() throws {
		let parsed = try HTML(html: html("basic")).parse().get()
		XCTAssertEqual(6, parsed.find(.p).count)
		XCTAssertEqual(9, parsed.find(.p, .strong).count)

		for _ in 0 ..< 1000 {
			_ = parsed.find(.p, .strong)
		}
	}

	func testParsing() throws {
		let html = """
			<div id="readability-content"><div id="readability-page-1" class="page"><div id="article-body" data-readability-score="459.16291902071555"><p><strong>Early Depeche Mode albums were made by a band that looked and sounded like clean-cut choir boys. But by the time they rolled around to album number eight, they'd become snarling electronic grungers with as many bad habits as they had death wishes.</strong></p><p>And while their parents might have been worried, the resulting album was one of their finest, and the subsequent tour their most ridiculous. Welcome to the rock 'n' synth peak that was Songs of Faith and Devotion.</p><figure data-bordeaux-image-check=""><div><div><p><picture><source sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" type="image/webp" srcset="https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-1200-80.jpg.webp 1200w"></source></picture><img loading="lazy" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" alt="SOFAD" data-original-mos="https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh.jpg" srcset="https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh-1200-80.jpg 1200w" data-pin-media="https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh.jpg" src="https://cdn.mos.cms.futurecdn.net/VvhsTdaKQFTqwBWUVVdRSh.jpg"></img></p></div></div><figcaption itemprop="caption description"><span itemprop="copyrightHolder">(Image credit: Mute)</span></figcaption></figure><h3 id="section-introduction"><span>Introduction</span></h3><p>Songs of Faith and Devotion is widely regarded as Depeche Mode at their peak, but it's more of a twin peak, if we must be truly accurate.</p><figure data-readability-score="0.04999999999999982"><blockquote data-readability-score="9.1"><p>SOFAD has an air of rock 'n' roll menace that makes it more Roskilde than Basildon, of that there is no doubt.</p></blockquote></figure><p>Previous album Violator is held in just as high esteem with DM fans, but is in many ways Devotion's opposite: a perfect, slick, song-crafted album where everything is in time and clean-shaven.</p><p>Songs of Faith and Devotion (SOFAD, if you'll excuse our already bruised fingertips) is Violator's wilder relation, with chunks of humanity slapped on the sequencers, slightly off-kilter synth-rock songs about human grubbiness, and an air of rock 'n' roll menace that makes it more Roskilde than Basildon, of that there is no doubt.</p><p>It's an album swaying about like a drunken cousin at Violator's wedding and, if not quite upstaging the host with its popular swagger, is certainly about to be told to stand outside and sober up for a bit. And have a bloody shave while it's at it.</p><figure data-bordeaux-image-check=""><div><div><p><picture><source type="image/webp" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" srcset="https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-1200-80.jpg.webp 1200w"></source></picture><img data-pin-media="https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J.jpg" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" src="https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J.jpg" loading="lazy" alt="Dave Gahan" srcset="https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J-1200-80.jpg 1200w" data-original-mos="https://cdn.mos.cms.futurecdn.net/2XMiAPu7wbQBNJGLJoGQ3J.jpg"></img></p></div></div><figcaption itemprop="caption description"><span itemprop="copyrightHolder">(Image credit: Getty Images)</span></figcaption></figure><h3 id="section-wherever-next"><span>Wherever next?</span></h3><p>Whichever version of Depeche Mode is your peak, you can't deny the shadow Violator cast over subsequent Mode albums, especially so with SOFAD and its subsequent tour.</p><div data-readability-score="7.260957197302844" id="slice-container-newsletterForm-articleInbodyContent-nbfcC66ygH9SnbPULdrmwW"><div data-hydrate="true" data-readability-score="11.19128408091469"><div data-readability-score="19.24064643799472"><section data-readability-score="0.29000000000000004"><h2>Get the MusicRadar Newsletter</h2></section><section data-readability-score="4.6505444126074496"><p>Want all the hottest music and gear news, reviews, deals, features and more, direct to your inbox? Sign up here.</p></section></div></div></div><figure><blockquote data-readability-score="7.73"><p>None of us came back with the idea that we were going to make Violator 2.</p><figcaption><cite>Dave Gahan</cite></figcaption></blockquote></figure><p>Violator had taken the band to another level in terms of their success across the globe. Its World Violation tour saw them play to well over a million people by the end of the 1990s, with 50,000-seat stadiums packed out across the States alone.</p><p>After a couple of years off - probably just to get over the hangovers - the band reconvened for album number eight with everyone wondering how to follow the peak success of Violator.</p><p>And it would be the same team tackling the thorny issue. The elements were in place: Martin Gore's songwriting, Dave Gahan's singing, Alan Wilder's drumming, programming and co-production, and Andrew Fletcher's enthusiasm.</p><p>Luckily, the album had the all-important re-addition of Flood, aka Mark Ellis, who had also produced Violator. We say 'luckily' because Flood bought his famously short attention span to the SOFAD party. He doesn't like repeating the recording process with any album as he gets bored so easily, so was already guiding the band away from Violator for this recording.</p><p>Also luckily, Depeche were on board with that, and more than up for a change in direction. Gahan said at the time that none of us came back with the idea that we were going to make Violator 2.</p><p>Unluckily, this new path was about the only thing they all agreed on during the recording</p><figure data-bordeaux-image-check=""><div><div><p><picture><source srcset="https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-1200-80.jpg.webp 1200w" type="image/webp" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)"></source></picture><img sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" data-original-mos="https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR.jpg" data-pin-media="https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR.jpg" loading="lazy" alt="Martin Gore" src="https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR.jpg" srcset="https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/PKJ2c6YendMebzwJrZPBUR-1200-80.jpg 1200w"></img></p></div></div><figcaption itemprop="caption description"><span itemprop="copyrightHolder">(Image credit: Getty Images)</span></figcaption></figure><h3 id="section-the-recording-it-was-going-to-be-wonderful"><span>The Recording - "It was going to be wonderful"</span></h3><p>The recording of SOFAD started well. Martin had written some songs - again with the idea that they were going to go in a different direction.</p><figure><blockquote data-readability-score="8.77"><p>You spend a year making a record, you might as well have fun while you do it.</p><figcaption><cite>Martin Gore</cite></figcaption></blockquote></figure><p>"We'll just try to record them differently and make everything new and exciting," he said to Paul Morley on Channel 4 before the recording. "So we came over to Madrid. You spend a year making a record, you might as well have fun while you do it." Famous last words</p><p>But armed with new songs, a producer with different ideas, and Alan especially chomping at the bit for new recording methods, the plan was that this Madrid studio would be the ideal place for the band to focus on their new direction.</p><p>'We Were Going to Live Together, Record Together and It Was Going to Be Wonderful' is the hilariously titled documentary on what happened next. The band had not seen each other for two years and were suddenly packed into a studio too far to walk anywhere just to blow off some steam."Wonderful" it was not.</p><figure data-bordeaux-image-check=""><div><div><p><picture><source srcset="https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-320-80.png.webp 320w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-480-80.png.webp 480w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-650-80.png.webp 650w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-970-80.png.webp 970w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-1024-80.png.webp 1024w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-1200-80.png.webp 1200w" type="image/webp" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)"></source></picture><img loading="lazy" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" src="https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57.png" alt="Producer Flood" srcset="https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-320-80.png 320w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-480-80.png 480w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-650-80.png 650w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-970-80.png 970w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-1024-80.png 1024w, https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57-1200-80.png 1200w" data-original-mos="https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57.png" data-pin-media="https://cdn.mos.cms.futurecdn.net/6VemaoFhMBpDiFQgpkWt57.png"></img></p></div></div><figcaption itemprop="caption description"><span>Flood on the We Were Going to Live Together documentary</span><span itemprop="copyrightHolder">(Image credit: Mute / Youtube)</span></figcaption></figure><p>"It was just an incredibly hard record to make," is Flood's opening comment in the documentary, and you can tell from his eyes that even that is a massive understatement. He's rarely spoken about SOFAD since, such is the apparent PTSD.</p><figure><blockquote><p>I created a monster.</p><figcaption><cite>Dave Gahan</cite></figcaption></blockquote></figure><p>The problems were caused not only by the studio location and pressure to follow up Violator, but also to explore all-new recording methods while they were at it, and all overshadowed by a lead singer's drug problems that had gone supernova since he'd last seen the band.</p><p>Gahan had also assumed an all-new rock star persona: long-haired, skinny, bearded and with an attitude to match, thanks to a new appreciation of US rock bands picked up during his time in LA.</p><p>"I created a monster," he told later told NME, and it would have to be this monster that Flood and Wilder would have to channel and join up with Gore's songs to create SOFAD.</p><figure data-bordeaux-image-check=""><div><div><p><picture><source sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" srcset="https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-1200-80.jpg.webp 1200w" type="image/webp"></source></picture><img data-pin-media="https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n.jpg" src="https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n.jpg" alt="Depeche Mode" srcset="https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n-1200-80.jpg 1200w" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" data-original-mos="https://cdn.mos.cms.futurecdn.net/ebrrywLNYr3oVnq4TE7V8n.jpg" loading="lazy"></img></p></div></div><figcaption itemprop="caption description"><span itemprop="copyrightHolder">(Image credit: Getty Images)</span></figcaption></figure><h3 id="section-the-studio-tech"><span>The studio tech</span></h3><p>The problem with a rock direction for the Mode at this point was basic and quite simple: they weren't a rock band. With Wilder the only trained musician, there was no way they'd go into the studio and just play Gore's tunes.</p><figure data-readability-score="0.5249999999999999"><blockquote data-readability-score="10.05"><p>We're not capable of going into a room, playing together, and coming up with some magical piece of music.</p><figcaption><cite>Alan Wilder</cite></figcaption></blockquote></figure><p>"When we just go in and play together, we end up sounding like a pub rock band," Wilder told <a href="https://www.muzines.co.uk/articles/modus-operandi/10646" data-url="https://www.muzines.co.uk/articles/modus-operandi/10646" data-hl-processed="none" data-analytics-id="inline-link" referrerpolicy="no-referrer-when-downgrade" rel="sponsored noopener" target="_blank">Sound On Sound/Keyboard Magazine in July 93</a>. "We're not capable of going into a room, playing together, and coming up with some magical piece of music."</p><p>But the solution was studio technology - certainly no stranger to the band - but used in a completely different way. With every album before SOFAD, Depeche Mode had used cutting-edge studio gear to create new sounds, whether that was synth for their pop, or the Emulators for their darker, industrial beats. With Songs of Faith and Devotion they effectively used the technology to sound human.</p><p>On tracks like Walking In My Shoes and I Feel You, the drums were played and recorded live, but then samples were taken, looped and sequenced in Cubase in a different order. Not a new thing by any means now, but it was for the Mode at the time.</p><p>Alan summed the differences between this approach and previous album Violator in the We Were Going To Live Together documentary: "Violator is very programmed with lots of individual sampled sounds. But they are all programmed on the exact beat, whereas later [with SOFAD] we'd use big chunks of performance that would have all the inherent mistakes and humanity.</p><p>"For me the combination of using all of that modern technology with all of that character is what makes more interesting music."</p><figure data-bordeaux-image-check=""><div><div><p><picture><source sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" srcset="https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-1200-80.jpg.webp 1200w" type="image/webp"></source></picture><img src="https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV.jpg" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" loading="lazy" data-pin-media="https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV.jpg" data-original-mos="https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV.jpg" alt="Recoil" srcset="https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/6gc2jq5Waxvw2bEiXuMJeV-1200-80.jpg 1200w"></img></p></div></div><figcaption itemprop="caption description"><span>Alan Wilder performing as Recoil in 2010</span><span itemprop="copyrightHolder">(Image credit: Getty Images)</span></figcaption></figure><p>Despite the issues in the studio - understandably by this time, everyone was getting on everybody else's nerves - Wilder and Flood would piece the album together over long 12-hour sessions.</p><figure><blockquote data-readability-score="8.19"><p>Our guitar parts tend to go quite weird. We run them through Leslies and other devices that make them less guitar-like.</p><figcaption><cite>Alan Wilder</cite></figcaption></blockquote></figure><p>And while the sound was way more 'LA' than 'Essex circa 1981', there were a surprising number of synths used on SOFAD to back up all that sampling.</p><p>As Wilder explained to <a data-analytics-id="inline-link" rel="sponsored noopener" data-url="https://www.muzines.co.uk/articles/modus-operandi/10646" data-hl-processed="none" href="https://www.muzines.co.uk/articles/modus-operandi/10646" target="_blank" referrerpolicy="no-referrer-when-downgrade">SOS/Keyboard</a>: "We've still got the same selection of samplers - Akais and [Emu] Emulators. And lots of rackmounted and modular synths: a Minimoog, Oberheims, the <a data-auto-tag-linker="true" data-analytics-id="inline-link" data-before-rewrite-localise="https://www.musicradar.com/tag/roland" href="https://www.musicradar.com/tag/roland">Roland</a> 700 system, ARP 2600s. There are fewer modern synthesizers than ever before - no DX7s, PPGs or things like that."</p><p>And even though rock was the new star, it was never going to be normal rock.</p><p>"We have a very strong aversion to typical rock guitar playing," Wilder added. "Our guitar parts tend to go quite weird. We run them through Leslies and other devices that make them less guitar-like while still keeping some of the power of the instrument."</p><h3 id="section-post-traumatic-sofad-disorder"><span>Post Traumatic SOFAD Disorder</span></h3><figure data-bordeaux-image-check=""><div><div><p><picture><source sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" srcset="https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-1200-80.jpg.webp 1200w" type="image/webp"></source></picture><img data-original-mos="https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa.jpg" srcset="https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa-1200-80.jpg 1200w" data-pin-media="https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa.jpg" src="https://cdn.mos.cms.futurecdn.net/6vh3GSKEKSnt7yDXAdnuZa.jpg" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" loading="lazy" alt="Live Martin Gore"></img></p></div></div><figcaption itemprop="caption description"><span itemprop="copyrightHolder">(Image credit: Getty Images)</span></figcaption></figure><p>SOFAD came out in January 1993 and hit the top of the charts in 10 countries, including both the US and UK. It has currently sold four million units and remains one of Depeche Mode's most critically-acclaimed recordings.</p><figure><blockquote data-readability-score="7.8"><p>This huge Bugs Bunny doll would become quite animated when I was out of my mind.</p><figcaption><cite>Dave Gahan</cite></figcaption></blockquote></figure><p>But as successful as the album was, the signs were probably on that Madrid studio wall that the tour that resulted from those recording sessions would be anything but normal.</p><p>The Devotional tour that played across close to 100 dates in 1993 probably requires its own film one day. Call it 'Spinal Tap 3', if you like, but make it a proper documentary, not a comedy.</p><p>There have been stories, rumours, facts and fiction written about the tour: that the band drove in different limos and stayed at different hotels; that they had their own psychiatrist and spiritualist; that support bands came and went because they couldn't keep up; even that Dave slept in a coffin.</p><p>But what was undoubtedly true about the tour was the subsequent impact that it had on the band's health.</p><p>With his spiralling drug problems, Gahan ended up "living in a little apartment in Santa Monica and I had this huge Bugs Bunny doll [which] would become quite animated when I was out of my mind," he told ModeFan.com in 2005.</p><p>"I also had a Tin Man and a Lion. The Tin Man used to speak to me. It was basically psychotic behaviour, which of course now I can see. But at the time I thought, Doesnt everyone have these things?</p><p>The fallout, both in the long and short term, was just as bad elsewhere.</p><figure data-bordeaux-image-check=""><div><div><p><picture><source sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" srcset="https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-1200-80.jpg.webp 1200w" type="image/webp"></source></picture><img src="https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn.jpg" loading="lazy" alt="Depeche Mode" data-original-mos="https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn.jpg" srcset="https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn-1200-80.jpg 1200w" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" data-pin-media="https://cdn.mos.cms.futurecdn.net/MdHbW47dkuFiEnKgcVSMUn.jpg"></img></p></div></div><figcaption itemprop="caption description"><span itemprop="copyrightHolder">(Image credit: Getty Images)</span></figcaption></figure><p>Fletch had a breakdown and at one stage left the tour, Gore had seizures and admitted his alcoholism, and Wilder was so affected he simply left the band.</p><figure data-readability-score="0.645"><blockquote data-readability-score="10.29"><p>After a hefty drugs overdose, he died for two minutes, complete with a near death experience. Sure you want to be in a rock band?</p></blockquote></figure><p>But leave it to Dave Gahan to top the lot, and nearly himself. He had an actual heart attack on stage, and later, after a hefty drugs overdose, died for two minutes, complete with a near death experience.</p><p>Sure you want to be in a successful rock band?</p><p>That any of the band even survived the 1990s is a miracle. That Depeche Mode are still making great records and touring 30 years on - they just finished a marathon set of dates for the excellent Memento Mori album - is simply insane.</p><p>So, despite the utter destruction that followed its recording, SOFAD's success played a big part in the band's longevity. With it, there was very nearly no Depeche Mode three decades ago. Yet without it, there would be no Depeche Mode today.</p><figure data-bordeaux-image-check=""><div><div><p><picture><source type="image/webp" srcset="https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-320-80.jpg.webp 320w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-480-80.jpg.webp 480w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-650-80.jpg.webp 650w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-970-80.jpg.webp 970w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-1024-80.jpg.webp 1024w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-1200-80.jpg.webp 1200w" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)"></source></picture><img alt="Depeche Mode" loading="lazy" sizes="(min-width: 1000px) 970px, calc(100vw - 40px)" data-pin-media="https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68.jpg" data-original-mos="https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68.jpg" srcset="https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-320-80.jpg 320w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-480-80.jpg 480w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-650-80.jpg 650w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-970-80.jpg 970w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-1024-80.jpg 1024w, https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68-1200-80.jpg 1200w" src="https://cdn.mos.cms.futurecdn.net/AHXqSwecDUc2uANKVRXS68.jpg"></img></p></div></div><figcaption itemprop="caption description"><span itemprop="copyrightHolder">(Image credit: Getty Images)</span></figcaption></figure><h3 id="section-the-songs-of-faith-and-devotion-track-by-track"><span>The Songs of Faith and Devotion  track by track</span></h3><p>Let's take a look at the tracks on SOFAD with some commentary from Alan Wilder from his excellent <a target="_blank" data-url="http://www.recoil.co.uk/#!/evidence/qa-vault/qa-depeche-mode/qa-depeche-mode-songs-of-faith-and-devotion/" referrerpolicy="no-referrer-when-downgrade" data-hl-processed="none" href="http://www.recoil.co.uk/#!/evidence/qa-vault/qa-depeche-mode/qa-depeche-mode-songs-of-faith-and-devotion/" rel="sponsored noopener" data-analytics-id="inline-link">Q&A section at recoli.co.uk</a>.</p><h2 id="i-feel-you-2">I Feel You</h2><p>The screeching tyre sound - actually a synth - that opens SOFAD on I Feel You is Dave and the band driving an XR2 Fiesta out of Basildon aiming for LA, squealing to a halt in front of you while Dave puts a cassette in, smiling as he knows you're going to be surprised by the album you're about to hear. You think, 'you really shouldn't be driving Dave', but give the album a listen anyway.</p><p>"Everyone else felt I Feel You should be first [as a single]," Alan Wilder says on <a rel="sponsored noopener" data-analytics-id="inline-link" referrerpolicy="no-referrer-when-downgrade" target="_blank" href="http://www.recoil.co.uk/" data-hl-processed="none" data-url="http://www.recoil.co.uk/">Recoil</a>. "The main reason for the choice was that the track had attitude and was radically different to what we had done before. We hoped it would surprise people and make them curious about the rest of the album."</p><p>It certainly did that</p><h2 id="walking-in-my-shoes-2">Walking in My Shoes</h2><p>According to Wilder, this second SOFAD single is one of the few Mode tracks that came together through jamming, with he and Martin playing bass and guitar respectively over a drum machine, after which he and Flood constructed the arrangement as he and we described earlier.</p><p>The result is a highlight track still played live to this day, while the accompanying video is all religion, naked women and moody black and white shots - standard DM fair, then. That said, the weird beaked creatures in the video that also appear on the live Devotional backdrop are cool, and we're pretty sure Dave had his eyes on them to go in his flat with his Bugs Bunny and Tin Man.</p><h2 id="condemnation-2">Condemnation</h2><p>If by now you are in any doubt that SOFAD is a departure for the Mode - and you shouldn't be - then the gospel-laden Condemnation should seal the deal with its soul, heart, incredible vocal and not an <a data-analytics-id="inline-link" data-before-rewrite-localise="https://www.musicradar.com/how-to/depeche-mode-synths" href="https://www.musicradar.com/how-to/depeche-mode-synths">ARP 2600</a> in sight.</p><p>I mean, whatever next? Country and western?</p><h2 id="mercy-in-you-2">Mercy in You</h2><p>Not one of Alan's top picks from SOFAD according to <a data-analytics-id="inline-link" data-url="http://www.recoil.co.uk/" referrerpolicy="no-referrer-when-downgrade" data-hl-processed="none" rel="sponsored noopener" target="_blank" href="http://www.recoil.co.uk/">Recoil</a> - "I dont think it was particularly bad, it just wasnt one of my favourites and took some time to complete" - but Mercy In You does have some fine elements: the backwards tracks, the chugging vocal, and the harmonies, plus the chorus is greater than the track four position promises. But yeah, it probably did take too long</p><h2 id="judas-2">Judas</h2><p>Judas is one of the most underrated tracks on one of the highest-rated DM albums, which should be enough, but we think it deserves even wider praise. Of all the tracks on SOFAD it might be less 'new direction' than old, but is still one of Martin's finer solo moments. Lovely strings, amazing vocals, a nice electronic sequence to close, and a superb atmosphere overall.</p><p>But not such a superb atmosphere during its recording according to Alan on <a data-hl-processed="none" referrerpolicy="no-referrer-when-downgrade" target="_blank" data-analytics-id="inline-link" data-url="http://www.recoil.co.uk/" rel="sponsored noopener" href="http://www.recoil.co.uk/">Recoli</a>: "I think Martin was quite attached to his demo version but I felt it needed more atmosphere. He in turn didnt like the sequencer end section."</p><h2 id="in-your-room-2">In Your Room</h2><p>Here we go. You might not know it yet, but this is what you paid your entrance fee for. In Your Room is, quite simply, one of the top five Depeche Mode tracks of all time, <a href="https://www.musicradar.com/news/5-songs-depeche-mode" data-before-rewrite-localise="https://www.musicradar.com/news/5-songs-depeche-mode" data-analytics-id="inline-link">partly because we said it was here</a>, but mostly because it is 'everything Depeche Mode' in one track.</p><p>There's SOFAD DM, of course, there's incredibly moody DM, the subject matter is all sexy DM, and the arrangement is the perfect clash of electronics and rock. It really is the peak of SOFAD in that sense, so we're guessing you want some In Your Room facts, right?</p><p>According to Wilder on <a data-analytics-id="inline-link" href="http://www.recoil.co.uk/" data-url="http://www.recoil.co.uk/" data-hl-processed="none" target="_blank" referrerpolicy="no-referrer-when-downgrade" rel="sponsored noopener">Recoil</a>, the track employs a variphone which, depending on which corner of the internet you believe, is either anelectronic wind instrument from Cologne or an early Soviet synthesizer.</p><p>In Your Room also uses a sound that Wilder calles Splang which is "derived from a guitar. Each chord was sampled individually and then double-tracked with a second but different guitar sound. There is also a string/choir pad (another backwards sound) playing the same chords in the background."</p><h2 id="get-right-with-me-2">Get Right with Me</h2><p>If you were the song Get Right with Me, you'd be annoyed at having to follow In Your Room, and in some ways the track does suffer from its 'follow that' position. It's probably the most straight up rock/blues/gospel track on SOFAD  any DM album, in fact  and it fulfils its brief in less than three minutes.</p><p>But hang on, what's this? After Get Right With Me, DM insert one of their mini electronic tracks they used to include on earlier albums. These ditties often appeared as 'hidden' tracks, and while this is hardly hidden, it's a neat nod back to synthier times after the most acoustic of SOFAD tracks. </p><h2 id="rush-2">Rush</h2><p>'<a data-auto-tag-linker="true" href="https://www.musicradar.com/tag/rush" data-before-rewrite-localise="https://www.musicradar.com/tag/rush" data-analytics-id="inline-link">Rush</a> has to be about drugs, right?' someone rather forthrightly asks Alan at his Q&A on SOFAD at <a data-analytics-id="inline-link" href="http://www.recoil.co.uk/" data-url="http://www.recoil.co.uk/" target="_blank" referrerpolicy="no-referrer-when-downgrade" data-hl-processed="none" rel="sponsored noopener">Recoil</a>. To which he elegantly sidesteps by replying: "I always personally preferred to interpret his [Martin's] songs in exactly the same way as the audience might, using ones own imagination and consequently giving them ones own personal meaning."</p><p>What Rush <em>is</em> though is one of SOFAD's highlights; a blistering wakeup call where synths sound like guitars and vice-versa and where Dave sings 'when I come up, I rush for you' like he really ruddy well means it. It's about drugs then, isn't it?</p><h2 id="one-caress-2">One Caress</h2><p>Just when you think you've got your head around SOFAD  it's DM with real drums and guitars and long hair, right?  along comes One Caress, all string quartets and Martin probably wearing some kind of powdered wig as he saunters through his 16th-century ballroom, singing one of his best ever songs and swinging a cane.</p><p>By this point, if the band closed SOFAD with a 1940s jazz number number in 13/4 time you wouldn't be surprised. Fortunately, it's a lot better than even that.</p><h2 id="higher-love-2">Higher Love</h2><p>Where many bands might finish off an album with a throwaway track - "just stick that on the end, no-one will notice" - Depeche Mode have always gone out on a high. From Just Can't Get Enough on their debut album, for example, to Clean on Violator. Need we say more?</p><p>Higher Love is right up there with In Your Room on SOFAD according to these ears, and springs to life from its swirling production into a rock synth classic. So good, in fact, that <a href="https://www.musicradar.com/news/bono-the-edge-u2-tiny-desk-concert" data-analytics-id="inline-link" data-before-rewrite-localise="https://www.musicradar.com/news/bono-the-edge-u2-tiny-desk-concert">U2</a> might have even lifted the drums to use in their track So Cruel on <a href="https://www.musicradar.com/news/u2-av-the-sphere" data-analytics-id="inline-link" data-before-rewrite-localise="https://www.musicradar.com/news/u2-av-the-sphere">Achtung Baby</a>. Well, not <a data-auto-tag-linker="true" data-analytics-id="inline-link" data-before-rewrite-localise="https://www.musicradar.com/tag/u2" href="https://www.musicradar.com/tag/u2">U2</a>, per se: "Didnt Flood work on both LPs?" Alan enquires on Recoil.</p><p>Anyway, it's damn near perfect ending to a damn near perfect DM album that has everything from rock to classical and blues to sequences. As Bugs Bunny might say, 'That's all folks'.</p></div></div></div>
		"""

		let parsed = try HTML(html: html).parse().get()

		for _ in 0 ..< 1000 {
			_ = parsed.find(.p, .strong)
		}
	}
}
